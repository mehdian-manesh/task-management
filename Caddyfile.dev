{
    debug
    local_certs
}

# HTTP for both localhost and server IP
http://localhost http://{env.DOMAIN} {
    handle /api/* {
        reverse_proxy task-management-backend:8000
    }

    handle /media/* {
        reverse_proxy task-management-backend:8000
    }

    handle {
        reverse_proxy task-management-frontend:3000
    }

    encode gzip

    log {
        output stdout
        format console
        level DEBUG
    }
}

# HTTPS for both localhost and server IP (tls internal issues certs for any DOMAIN)
https://localhost https://{env.DOMAIN} {
    tls internal
    handle /api/* {
        reverse_proxy task-management-backend:8000
    }

    handle /media/* {
        reverse_proxy task-management-backend:8000
    }

    handle {
        reverse_proxy task-management-frontend:3000
    }

    encode gzip

    log {
        output stdout
        format console
        level DEBUG
    }
}
