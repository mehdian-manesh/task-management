{
    debug
    local_certs
}

# HTTP for both localhost and server IP
http://localhost http://{env.DOMAIN} {
    handle_path /api/* {
        reverse_proxy backend:8000
    }

    handle /media/* {
        reverse_proxy backend:8000
    }

    handle {
        reverse_proxy frontend:3000
    }

    encode gzip

    log {
        output stdout
        format console
        level DEBUG
    }
}

# HTTPS for both localhost and server IP
https://localhost https://{env.DOMAIN} {
    handle_path /api/* {
        reverse_proxy backend:8000
    }

    handle /media/* {
        reverse_proxy backend:8000
    }

    handle {
        reverse_proxy frontend:3000
    }

    encode gzip

    log {
        output stdout
        format console
        level DEBUG
    }
}
